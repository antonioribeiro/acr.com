--
-- PostgreSQL database dump
--

SET statement_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SET check_function_bodies = false;
SET client_min_messages = warning;

SET search_path = public, pg_catalog;

DROP FUNCTION public.construe_cascade_translations();
DROP EXTENSION plpgsql;
DROP SCHEMA public;
--
-- Name: public; Type: SCHEMA; Schema: -; Owner: postgres
--

CREATE SCHEMA public;


ALTER SCHEMA public OWNER TO postgres;

--
-- Name: SCHEMA public; Type: COMMENT; Schema: -; Owner: postgres
--

COMMENT ON SCHEMA public IS 'standard public schema';


--
-- Name: plpgsql; Type: EXTENSION; Schema: -; Owner: 
--

CREATE EXTENSION IF NOT EXISTS plpgsql WITH SCHEMA pg_catalog;


--
-- Name: EXTENSION plpgsql; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION plpgsql IS 'PL/pgSQL procedural language';


SET search_path = public, pg_catalog;

--
-- Name: construe_cascade_translations(); Type: FUNCTION; Schema: public; Owner: antoniocarlos
--

CREATE FUNCTION construe_cascade_translations() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
                        BEGIN
                            if not NEW.auto_inserted then
                                INSERT INTO construe_messages (language_id, country_id, module_id, message_hash, translator_id, message, auto_inserted, created_at, updated_at)
                                    SELECT l.language_id, l.country_id, m.module_id, m.message_hash, 0, m.message, true, 'NOW', 'NOW'
                                    FROM construe_messages m
                                    JOIN construe_country_languages l on l.enabled = true and (not (l.language_id = 'en' and l.country_id = 'US'))
                                    WHERE m.language_id = 'en'
                                        AND m.country_id = 'US'
                                        AND (module_id,message_hash) NOT IN
                                            (SELECT module_id,message_hash FROM construe_messages where language_id = l.language_id and country_id = l.country_id);
                            end if;

                            RETURN NEW;
                        END;
                        $$;


ALTER FUNCTION public.construe_cascade_translations() OWNER TO antoniocarlos;

--
-- Name: public; Type: ACL; Schema: -; Owner: postgres
--

REVOKE ALL ON SCHEMA public FROM PUBLIC;
REVOKE ALL ON SCHEMA public FROM postgres;
GRANT ALL ON SCHEMA public TO postgres;
GRANT ALL ON SCHEMA public TO PUBLIC;


--
-- PostgreSQL database dump complete
--

